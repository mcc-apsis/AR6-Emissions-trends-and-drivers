---
title: "data_checking"
author: "William F. Lamb"
output: 
  word_document:
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding, output_dir = "../Results") })
  
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE,warning=FALSE)

rm(list = ls())
library(tidyverse)
library(ggpubr)
library(openxlsx)
theme_set(theme_bw())

load('../../Data/edgar_data_all.RData')
load('../../Data/edgar_data_gwp_ar6.RData')
load('../../Data/basic.RData')


```

## compare EDGAR data online to ours


```{r ch4_compare}

# compare my processed edgar data, the raw edgar data and published edgar data

edgar_public_ch4 <- read.xlsx('../../Data/EDGAR/public version/v50_CH4_1970_2015.xlsx',sheet=1,startRow = 9)
edgar_public_ch4 <- gather(edgar_public_ch4,year,value,`1970`:`2015`)
edgar_public_ch4 <- edgar_public_ch4 %>% 
  mutate(value=as.numeric(value)) %>% 
  mutate(year=as.numeric(year)) %>% 
  group_by(year) %>% 
  summarise(ch4_public=sum(value,na.rm=T)*1000)

edgar_raw_ch4 <- read.xlsx('../../Data/EDGAR/EDGAR v5.0 Part A--CO2 CH4 N2O FT2018 (1970-2018) by JRC and PBL 26Nov2019 for IPCC_WGIII.xlsx',sheet= 3,startRow = 10)
edgar_raw_ch4 <- edgar_raw_ch4[1:58]
edgar_raw_ch4 <- gather(edgar_raw_ch4,year,value,`1970`:`2018`)

edgar_raw_landfill <- openxlsx::read.xlsx("../../Data/EDGAR/updated EDGAR landfills emissions.xlsx","CH4 emi landfills",startRow=2) %>% 
  select(ISO=Country_code_A3,everything(),-emi_id,-Substance)

edgar_raw_landfill <- gather(edgar_raw_landfill,year,CH4,-ISO)
edgar_raw_landfill$year <- gsub("Y_","",edgar_raw_landfill$year)
edgar_raw_landfill <- edgar_raw_landfill %>% 
  mutate(IPCC="6A1") %>% 
  mutate(CH4=as.numeric(CH4))

edgar_raw_ch4 <- left_join(edgar_raw_ch4,edgar_raw_landfill,by = c("year","ISO","IPCC"))
edgar_raw_ch4 <- edgar_raw_ch4 %>% 
  mutate(value=ifelse(IPCC=="6A1",CH4,value)) %>% 
  mutate(year=as.numeric(year))

edgar_raw_ch4 <- edgar_raw_ch4 %>% 
  group_by(year) %>% 
  summarise(ch4_raw=sum(value,na.rm=T)*1000)

compare_ch4 <- edgar_GHG %>% 
  group_by(year) %>% 
  summarise(ch4_ipcc=sum(CH4,na.rm=T))

compare_ch4 <- left_join(compare_ch4,edgar_public_ch4,by = "year")
compare_ch4 <- left_join(compare_ch4,edgar_raw_ch4,by = "year")

compare_ch4 <- gather(compare_ch4,var,value,-year) 
compare_ch4 %>% 
  ggplot(.,aes(x=year,y=value,colour=var)) + 
  geom_line()

compare_ch4 %>% 
  filter(year %in% c(1970,1990,2010,2018)) %>% 
  ggplot(.,aes(x=var,y=value,fill=var)) +
  geom_bar(stat='identity') +
  facet_grid(year~.) +
  coord_flip()

```

```{r n2o_compare}

edgar_public_n2o <- read.xlsx('../../Data/EDGAR/public version/v50_N2O_1970_2015.xlsx',sheet=1,startRow = 9)
edgar_public_n2o <- gather(edgar_public_n2o,year,value,`1970`:`2015`)
edgar_public_n2o <- edgar_public_n2o %>% 
  mutate(value=as.numeric(value)) %>% 
  mutate(year=as.numeric(year)) %>% 
  group_by(year) %>% 
  summarise(n2o_public=sum(value,na.rm=T)*1000)

edgar_raw_n2o <- read.xlsx('../../Data/EDGAR/EDGAR v5.0 Part A--CO2 CH4 N2O FT2018 (1970-2018) by JRC and PBL 26Nov2019 for IPCC_WGIII.xlsx',sheet= 4,startRow = 10)
edgar_raw_n2o <- edgar_raw_n2o[1:58]
edgar_raw_n2o <- gather(edgar_raw_n2o,year,value,`1970`:`2018`)
edgar_raw_n2o <- edgar_raw_n2o %>% 
  mutate(value=as.numeric(value)) %>% 
  mutate(year=as.numeric(year)) %>% 
  group_by(year) %>% 
  summarise(n2o_raw=sum(value,na.rm=T)*1000)

compare_n2o <- edgar_GHG %>% 
  group_by(year) %>% 
  summarise(n2o_ipcc=sum(N2O,na.rm=T))
  
compare_n2o <- left_join(compare_n2o,edgar_public_n2o,by = "year")
compare_n2o <- left_join(compare_n2o,edgar_raw_n2o,by = "year")

compare_n2o <- gather(compare_n2o,var,value,-year) 
compare_n2o %>% 
  ggplot(.,aes(x=year,y=value,colour=var)) + 
  geom_line()

compare_n2o %>% 
  filter(year %in% c(1970,1990,2010,2018)) %>% 
  ggplot(.,aes(x=var,y=value,fill=var)) +
  geom_bar(stat='identity') +
  facet_grid(year~.) +
  coord_flip()


```

```{r co2_compare}

edgar_public_co2 <- read.xlsx('../../Data/EDGAR/public version/v50_CO2_excl_short-cycle_org_C_1970_2018.xlsx',sheet=1,startRow = 9)
edgar_public_co2 <- gather(edgar_public_co2,year,value,`1970`:`2018`)
edgar_public_co2 <- edgar_public_co2 %>% 
  mutate(value=as.numeric(value)) %>% 
  mutate(year=as.numeric(year)) %>% 
  group_by(year) %>% 
  summarise(co2_public=sum(value,na.rm=T)*1000)

edgar_raw_co2 <- read.xlsx('../../Data/EDGAR/EDGAR v5.0 Part A--CO2 CH4 N2O FT2018 (1970-2018) by JRC and PBL 26Nov2019 for IPCC_WGIII.xlsx',sheet= 2,startRow = 10)
edgar_raw_co2 <- edgar_raw_co2[1:58]
edgar_raw_co2 <- gather(edgar_raw_co2,year,value,`1970`:`2018`)
edgar_raw_co2 <- edgar_raw_co2 %>% 
  mutate(value=as.numeric(value)) %>% 
  mutate(year=as.numeric(year)) %>% 
  group_by(year) %>% 
  summarise(co2_raw=sum(value,na.rm=T)*1000)

compare_co2 <- edgar_GHG %>%
  group_by(year) %>%
  summarise(co2_ipcc=sum(CO2,na.rm=T))

compare_co2 <- left_join(compare_co2,edgar_public_co2,by = "year")
compare_co2 <- left_join(compare_co2,edgar_raw_co2,by = "year")

compare_co2 <- gather(compare_co2,var,value,-year) 
compare_co2 %>% 
  ggplot(.,aes(x=year,y=value,colour=var)) + 
  geom_line()

compare_co2 %>% 
  filter(year %in% c(1970,1990,2010,2018)) %>% 
  ggplot(.,aes(x=var,y=value,fill=var)) +
  geom_bar(stat='identity') +
  facet_grid(year~.) +
  coord_flip()

```

```{r fgas_compare}

edgar_raw_fgas <- read.xlsx('../../Data/EDGAR/EDGAR v5.0 Part B--F-gases FT2018 (1970-2018) by JRC and PBL 26Nov2019 for IPCC_WGIII.xlsx',sheet= 2,startRow = 10)
edgar_raw_fgas <- edgar_raw_fgas[1:58]
edgar_raw_fgas <- gather(edgar_raw_fgas,year,value,`1970`:`2018`)
edgar_raw_fgas <- edgar_raw_fgas %>% 
  mutate(value=as.numeric(value)) %>% 
  mutate(year=as.numeric(year)) %>% 
  group_by(year,Fgas) %>% 
  summarise(fgas_raw=sum(value,na.rm=T)*1000)

compare_fgas <- edgar_GHG %>%
  group_by(year) %>%
  summarise_at(vars(`c-C4F8`:SF6),sum,na.rm=T)

compare_fgas <- gather(compare_fgas,Fgas,fgas_ipcc,-year)

compare_fgas <- left_join(compare_fgas,edgar_raw_fgas,by = c("year","Fgas"))

compare_fgas <- gather(compare_fgas,var,value,-year,-Fgas) 
compare_fgas %>% 
  ggplot(.,aes(x=year,y=value,colour=var)) + 
  geom_line() +
  facet_wrap(.~Fgas,scales="free")

```



```{r check_gwps}

totals <- rbind(compare_ch4 %>% mutate(gas="CH4"),compare_n2o %>% mutate(gas="N2O"),compare_co2 %>% mutate(gas="CO2")) %>% 
  filter(year==2015)

edgar_ipcc_gwps <- edgar_GHG_ar6 %>% 
  group_by(year) %>% 
  summarise_at(vars(CO2,CH4,N2O),sum,na.rm=T)

edgar_ipcc_gwps <- gather(edgar_ipcc_gwps,gas,ipcc_gwp,CO2:N2O)

totals <- left_join(totals,edgar_ipcc_gwps,by = c("year", "gas"))

load('../../Data/gwps.RData')

totals <- totals %>% 
  mutate(ipcc_gwp = ifelse(gas=="N2O",ipcc_gwp/261,ipcc_gwp))

```


## Single out countries with high emissions contributions from individual sectors

```{r crazy_countries,fig.width=8,fig.height=20,fig.path="../Results/Plots/Checks/",dev=c('png','pdf')}

##

data <- edgar_GHG_ar6 %>% 
  group_by(country,year) %>% 
  mutate(country_GHG=sum(GHG,na.rm=TRUE)) %>% 
  ungroup()

blarg <- edgar_GHG_ar6 %>% 
  group_by(country,ISO,year) %>% 
  summarise(GHG=sum(GHG,na.rm=T))

blarg <- left_join(blarg,basic %>% select(ISO,year=Year,pop_UN))

blarg <- blarg %>% 
  mutate(ghgpc = GHG/pop_UN) %>% 
  filter(year==2018) %>% 
  arrange(desc(ghgpc))

data <- data %>% 
  mutate(sector_fraction=(GHG/country_GHG)*100)

data <- data %>% 
  filter(region_ar6_5_short!="AIR") %>% 
  filter(region_ar6_5_short!="SEA") 

data <- data %>% 
  filter(year==2018) %>% 
  group_by(country) %>% 
  arrange(desc(sector_fraction)) %>% 
  mutate(include=ifelse(first(sector_fraction)>50,1,0)) %>% 
  ungroup()


data <- data %>% 
  filter(country_GHG>1e6) %>% ## exclude countries with less than 1Mt CO2
  filter(include==1) %>% 
  group_by(country) %>% 
  top_n(10,wt = GHG) %>% 
  ungroup()




data <- gather(data,gas,value,CO2:Fgas)


data %>% ggplot(.,aes(x=reorder(description,desc(value)),y=value,fill=gas)) +
  geom_bar(stat='identity') +
  coord_flip() +
  facet_wrap(.~country,scales='free',ncol=1) +
  theme_bw() +
  theme(legend.position="top",
        legend.title=element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank())
  



```

```{r cement,fig.width=8,fig.height=10,fig.path="../Results/Plots/Checks/",dev=c('png','pdf')}

data <- edgar_GHG_ar6 %>% 
  filter(chapter_title=="Industry") %>%
  filter(year>1989) %>% 
  group_by(year,sector_code,description) %>% 
  summarise(value=sum(GHG,na.rm=T))

data %>%
  filter(value>1e8) %>% 
  ggplot(.,aes(x=year,y=value,colour=description)) +
  geom_path() +
  facet_wrap(~description,ncol=4,scales='free',labeller = label_wrap_gen(width=15)) +
  theme(legend.position = "none")


```

```{r industry_check,fig.width=8,fig.height=6,fig.path="../Results/Plots/Checks/",dev=c('png','pdf')}

data <- edgar_GHG_ar6 %>% 
  filter(chapter_title=="Industry") %>%
  filter(year>1989) %>% 
  group_by(year,sector_code,description) %>% 
  summarise(value=sum(GHG,na.rm=T))
  

data %>%
  filter(str_detect(sector_code, "^2F") | str_detect(sector_code, "^2E")) %>% 
#  filter(sector_code=="2F1-4" | sector_code=="2F9" | sector_code=="2E1") %>% 
  ggplot(.,aes(x=year,y=value,colour=sector_code)) +
  geom_path() +
  facet_wrap(~sector_code,ncol=4,scales='free',labeller = label_wrap_gen(width=15)) +
  theme(legend.position = "none")


```

```{r building_check,fig.width=8,fig.height=6,fig.path="../Results/Plots/Checks/",dev=c('png','pdf')}

data <- edgar_GHG_ar6 %>% 
  filter(chapter_title=="Buildings")

library(openxlsx)
wb <- openxlsx::createWorkbook(title = "ipcc_ar6_edgar_buildings")
addWorksheet(wb,'all_data')
writeData(wb, sheet = "all_data", data, colNames = T)

sector_aggregation <- data %>% 
  group_by(year,sector_code,description) %>% 
  summarise_at(vars(CO2:GHG),sum,na.rm=T)
  
addWorksheet(wb,'sector_aggregation')
writeData(wb, sheet = "sector_aggregation", sector_aggregation, colNames = T)

unique_codes <- data %>% 
  select(sector_code,description) %>% 
  unique()

addWorksheet(wb,'codes_in_data')
writeData(wb, sheet = "codes_in_data", unique_codes, colNames = T)


global_totals <- edgar_GHG_ar6 %>% 
  filter(year==2018) %>% 
  summarise_at(vars(CO2:GHG),sum,na.rm=T) %>% 
  mutate(chapter_title='Total')

totals_data <- edgar_GHG_ar6 %>% 
  filter(year==2018) %>% 
  group_by(chapter_title) %>% 
  summarise_at(vars(CO2:GHG),sum,na.rm=T)

totals_data <- rbind(totals_data,global_totals)

addWorksheet(wb,'totals_by_chapter_2018')
writeData(wb, sheet = "totals_by_chapter_2018",totals_data, colNames = T)

fgas_totals <- edgar_GHG_ar6 %>% 
  filter(year==2018) %>% 
  group_by(sector_code,description,chapter,chapter_title) %>% 
  summarise_at(vars(CO2:GHG),sum,na.rm=T)

addWorksheet(wb,'totals_by_code_2018')
writeData(wb, sheet = "totals_by_code_2018",fgas_totals, colNames = T)



saveWorkbook(wb,"../Results/Data/ipcc_ar6_edgar_buildings.xlsx",overwrite = T)



```

```{r worksheet_check,fig.width=8,fig.height=6,fig.path="../Results/Plots/testing/",dev=c('png','pdf')}



worksheet <- read.xlsx('../Results/Data/ipcc_ar6_edgar_data_gwp100_v3.xlsx','emissions_data')

plot_data <- worksheet %>% 
  filter(year>1989) %>% 
  filter(year<2019) %>% 
  group_by(year) %>% 
  summarise(CO2=sum(CO2,na.rm=T)/1e9,CH4=sum(CH4,na.rm=T)/1e9,N2O=sum(N2O,na.rm=T)/1e9,Fgas=sum(Fgas,na.rm=T)/1e9)


```

```{r double_counting,fig.width=8,fig.height=6,fig.path="../Results/Plots/testing/",dev=c('png','pdf')}

data <- edgar_GHG_ar5 %>% 
  filter(year==2018) %>% 
  #filter(str_detect(sector_code, "^1A")) %>% 
  group_by(year,sector_code,description) %>% 
  summarise(value=sum(GHG,na.rm=T))
  

data %>%
  filter(str_detect(sector_code, "^2F") | str_detect(sector_code, "^2E")) %>% 
  ggplot(.,aes(x=year,y=value,colour=sector_code)) +
  geom_path() +
  facet_wrap(~sector_code,ncol=4,scales='free',labeller = label_wrap_gen(width=15)) +
  theme(legend.position = "none")


```


```{r waste,fig.width=8,fig.height=6,fig.path="../Results/Plots/testing/",dev=c('png','pdf')}

data <- edgar_GHG_ar5 %>% 
  filter(year>1989) %>% 
  filter(str_detect(description, "Managed waste")) %>% 
  group_by(year,sector_code,description) %>% 
  summarise(value_new=sum(GHG,na.rm=T))


data2 <- edgar_GHG %>% 
  filter(year>1989) %>% 
  filter(str_detect(description, "Managed waste")) %>% 
  group_by(year,sector_code,description) %>% 
  summarise(value_old=sum(GHG,na.rm=T))  

data <- left_join(data,data2)

data <- data %>% 
  mutate(difference=value_new-value_old)

data <- gather(data,key,value,value_new:value_old)

data %>% ggplot(.,aes(x=year,y=value,colour=key)) +
  geom_line() +
  ggtitle(data$description[1])


```


## differences by gas


```{r total_gas_checks,fig.width=8,fig.height=6}

divide.by <- function(x, na.rm=FALSE) (x/1e9)

totals_new <- edgar_GHG_ar5 %>% 
  group_by(year) %>% 
  mutate_at(vars(CO2:GHG),divide.by) %>% 
  summarise_at(vars(CO2:GHG),sum,na.rm=T)

totals_old <- edgar_GHG %>% 
  group_by(year) %>% 
  mutate_at(vars(CO2:GHG),divide.by) %>% 
  summarise_at(vars(CO2:GHG),sum,na.rm=T) %>% 
  ungroup()

totals_new <- gather(totals_new,key,value_new,CO2:GHG)
totals_old <- gather(totals_old,key,value_old,CO2:GHG)

totals <- left_join(totals_new,totals_old)

totals$key=as.factor(totals$key)
totals$key <- factor(totals$key,levels(totals$key)[c(2,1,5,3,4)])


totals <- totals %>% 
  mutate(difference=(value_new-value_old)/value_new) %>% 
  filter(year!=2018)

totals %>% ggplot(.,aes(x=year,y=difference,fill=key)) +
  geom_bar(stat='identity') +
  facet_wrap(~key,scales='free',nrow = 2) +
  ylab("Difference in emissions (as % of the new data in that year)") +
  theme(legend.position="bottom",
        axis.title.x=element_blank(),
        legend.title=element_blank())


```

## differences by chapter


```{r total_chapter_checks,fig.width=8,fig.height=12}

divide.by <- function(x, na.rm=FALSE) (x/1e9)

totals_new <- edgar_GHG_ar5 %>% 
  group_by(year,chapter) %>% 
  mutate_at(vars(CO2:GHG),divide.by) %>% 
  summarise_at(vars(CO2:GHG),sum,na.rm=T)

totals_old <- edgar_GHG %>% 
  group_by(year,chapter) %>% 
  mutate_at(vars(CO2:GHG),divide.by) %>% 
  summarise_at(vars(CO2:GHG),sum,na.rm=T) %>% 
  ungroup()

totals_new <- gather(totals_new,key,value_new,CO2:GHG)
totals_old <- gather(totals_old,key,value_old,CO2:GHG)

totals <- left_join(totals_new,totals_old)

totals$key=as.factor(totals$key)
totals$key <- factor(totals$key,levels(totals$key)[c(2,1,5,3,4)])


totals <- totals %>% 
  mutate(difference=value_new-value_old) %>% 
  filter(year!=2018) %>% 
  filter(year>1989)

#totals <- totals %>% 
 # group_by(chapter,key) %>% 
  #filter(any(difference!=0))
  

totals %>% ggplot(.,aes(x=year,y=difference,fill=key)) +
  geom_bar(stat='identity') +
  facet_grid(chapter~key,scales='free') +
  ylab("Difference in emissions (GtCO2eq)") +
  theme(legend.position="bottom",
        axis.title.x=element_blank(),
        legend.title=element_blank())

```


## differences by individual sector


```{r total_sector_checks,fig.width=8,fig.height=12}

divide.by <- function(x, na.rm=FALSE) (x/1e9)

totals_new <- edgar_GHG_ar5 %>% 
  group_by(year,sector_code,description) %>% 
  mutate_at(vars(CO2:GHG),divide.by) %>% 
  summarise_at(vars(CO2:GHG),sum,na.rm=T)

totals_old <- edgar_GHG %>% 
  group_by(year,sector_code,description) %>% 
  mutate_at(vars(CO2:GHG),divide.by) %>% 
  summarise_at(vars(CO2:GHG),sum,na.rm=T) %>% 
  ungroup()

totals_new <- gather(totals_new,key,value_new,CO2:GHG)
totals_old <- gather(totals_old,key,value_old,CO2:GHG)

totals <- left_join(totals_new,totals_old)

totals$key=as.factor(totals$key)
totals$key <- factor(totals$key,levels(totals$key)[c(2,1,5,3,4)])

totals <- totals %>% 
  filter(year>1989) %>% 
  filter(key!="GHG") %>% 
  group_by(sector_code,description,key) %>% 
  summarise_at(vars(value_new:value_old),sum,na.rm=T) %>% 
  mutate(difference=(value_new-value_old)/value_new)

totals <- totals %>% 
  filter(!is.na(difference)) %>% 
  filter(difference!=0) %>% 
  filter(difference>0.09 | difference< -0.09) %>% 
  arrange(desc(difference))

totals %>% 
  ggplot(.,aes(x=reorder(description,difference),y=difference,fill=key)) +
  geom_bar(stat='identity') +
  coord_flip() +
  facet_wrap(~key,scales='free',ncol=1) +
  ylab("Relative increase (%) in emissions of new data, averaged 1990-2017") +
  theme(legend.position="bottom",
        axis.title.x=element_blank(),
        legend.title=element_blank())

```












## new data - sector trends


```{r sector_checks,fig.width=8,fig.height=6}

totals <- edgar_GHG_ar5 %>% 
  group_by(year,chapter_title) %>% 
  summarise_at(vars(CO2:Fgas),sum,na.rm=T)

totals <- gather(totals,key,value,CO2:Fgas)

totals <- totals %>% 
  group_by(chapter_title) %>% 
  mutate(nor=value/max(value)) %>% 
  arrange(year) %>% 
  group_by(chapter_title,key) %>% 
  mutate(nor_x=nor+(1-nth(nor,n=1)))


totals %>% ggplot(.,aes(x=year,y=nor_x,color=key)) +
  geom_line() +
  facet_wrap(~chapter_title,scales='free',nrow = 2) +
  theme(legend.position="bottom",
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        legend.title=element_blank())



```

## new data - region trends  

```{r region_checks,fig.width=8,fig.height=6}

totals <- edgar_GHG_ar5 %>% 
  group_by(year,region_ar6_5) %>% 
  summarise_at(vars(CO2:Fgas),sum,na.rm=T)

totals <- gather(totals,key,value,CO2:Fgas)

totals <- totals %>% 
  group_by(region_ar6_5) %>% 
  mutate(nor=value/max(value)) %>% 
  arrange(year) %>% 
  group_by(region_ar6_5,key) %>% 
  mutate(nor_x=nor+(1-nth(nor,n=1)))


totals %>% ggplot(.,aes(x=year,y=nor_x,color=key)) +
  geom_line() +
  facet_wrap(~region_ar6_5,scales='free',ncol=4,labeller = label_wrap_gen(width=18)) +
  theme(legend.position="bottom",
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        legend.title=element_blank())


```


## new data - high emitting country trends

```{r country_checks,fig.width=8,fig.height=6}

totals <- edgar_GHG_ar5 %>% 
  group_by(year,country) %>% 
  summarise_at(vars(CO2:GHG),sum,na.rm=T)

countries <- totals %>%
  ungroup() %>% 
  filter(year==2018) %>% 
  arrange(desc(GHG)) %>% 
  mutate(include=0)
countries$include[1:10] <- 1
countries <- countries %>% 
  select(country,include)

totals <- left_join(totals,countries,by=c("country"="country"))

totals <- gather(totals,key,value,CO2:Fgas)
totals <- totals %>% 
  filter(include==1) %>% 
  group_by(country,year) %>% 
  arrange(desc(value))

totals <- totals %>% 
  group_by(country) %>% 
  mutate(nor=value/max(value)) %>% 
  arrange(year) %>% 
  group_by(country,key) %>% 
  mutate(nor_x=nor+(1-nth(nor,n=1)))


totals %>% ggplot(.,aes(x=year,y=nor_x,color=key)) +
  geom_line() +
  facet_wrap(~country,scales='free',ncol=4,labeller = label_wrap_gen(width=18)) +
  theme(legend.position="bottom",
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        legend.title=element_blank())


```